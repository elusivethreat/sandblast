md5                     569594c89b970cede1158c02075e188c
sha1                    79ffb1402b8e8d4df0d5c430f4c2428d242e4f67
sha256                  b99dac5029d2aa728f5dbadcd0350fe15f437ce34b693533d6291c551b88d802
path                    /home/sandbox/Desktop/CustomSandbox/BasicMulti/uploads/79ffb1402b8e8d4df0d5c430f4c2428d242e4f67_beacon.bin
timestamp               2023-11-27 12:26:42.298813
capa version            6.1.0
os                      windows
format                  pe
arch                    i386
extractor               VivisectFeatureExtractor
base address            0x400000
rules                   /tmp/_MEIRI3KxD/rules
function count          50
library function count  2
total feature count     3436

allocate RW memory (library rule)
author  0x534a@mailbox.org
scope   basic block
mbc     Memory::Allocate Memory [C0007]
basic block @ 0x40158E in function 0x40158E
  and:
    match: allocate memory @ 0x40158E
      or:
        api: kernel32.VirtualAlloc @ 0x4015B5
    number: 0x4 = PAGE_READWRITE @ 0x40159A

allocate memory (6 matches, only showing first match of library rule)
author  0x534a@mailbox.org
scope   basic block
mbc     Memory::Allocate Memory [C0007]
basic block @ 0x40158E in function 0x40158E
  or:
    api: kernel32.VirtualAlloc @ 0x4015B5

contain loop (15 matches, only showing first match of library rule)
author  moritz.raabe@mandiant.com
scope   function
function @ 0x4014B0
  or:
    characteristic: loop @ 0x4014B0
    characteristic: tight loop @ 0x401370

create or open file (library rule)
author  michael.hunhoff@mandiant.com, joakim@intezer.com
scope   basic block
mbc     File System::Create File [C0016]
basic block @ 0x401732 in function 0x401732
  or:
    api: CreateFile @ 0x40177F

delay execution (3 matches, only showing first match of library rule)
author      michael.hunhoff@mandiant.com, @ramen0x3f
scope       basic block
mbc         Anti-Behavioral Analysis::Dynamic Analysis Evasion::Delayed Execution [B0003.003]
references  https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions, https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp
basic block @ 0x401208 in function 0x4014B0
  or:
    and:
      os: windows
      or:
        api: kernel32.Sleep @ 0x40120F

connect pipe
namespace  communication/named-pipe/connect
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com
scope      function
mbc        Communication::Interprocess Communication::Connect Pipe [C0003.002]
function @ 0x401648
  or:
    api: kernel32.ConnectNamedPipe @ 0x4016BB

create pipe
namespace  communication/named-pipe/create
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com
scope      function
mbc        Communication::Interprocess Communication::Create Pipe [C0003.001]
function @ 0x401648
  or:
    api: kernel32.CreateNamedPipe @ 0x40169D

write pipe
namespace  communication/named-pipe/write
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com
scope      function
mbc        Communication::Interprocess Communication::Write Pipe [C0003.004]
function @ 0x401648
  or:
    and:
      or:
        match: create pipe @ 0x401648
          or:
            api: kernel32.CreateNamedPipe @ 0x40169D
        match: connect pipe @ 0x401648
          or:
            api: kernel32.ConnectNamedPipe @ 0x4016BB
      api: kernel32.WriteFile @ 0x4016E6

contain a thread local storage (.tls) section
namespace  executable/pe/section/tls
author     michael.hunhoff@mandiant.com
scope      file
section: .tls @ 0x44A000

read file on Windows
namespace  host-interaction/file-system/read
author     moritz.raabe@mandiant.com, anushka.virgaonkar@mandiant.com
scope      function
mbc        File System::Read File [C0051]
function @ 0x401732
  or:
    and:
      os: windows
      optional:
        and:
          number: 0x80000000 = GENERIC_READ @ 0x401770
          match: create or open file @ 0x401732
            or:
              api: CreateFile @ 0x40177F
      or:
        api: kernel32.ReadFile @ 0x4017B0

write file on Windows (2 matches)
namespace  host-interaction/file-system/write
author     william.ballenthin@mandiant.com, anushka.virgaonkar@mandiant.com
scope      function
mbc        File System::Writes File [C0052]
function @ 0x401648
  or:
    and:
      os: windows
      optional:
        basic block:
          or:
            number: 0x2 = FILE_WRITE_DATA @ 0x40168E
      or:
        api: kernel32.WriteFile @ 0x4016E6
function @ 0x401E50
  or:
    and:
      os: windows
      or:
        api: fwrite @ 0x401E7B

get thread local storage value
namespace  host-interaction/process
author     michael.hunhoff@mandiant.com
scope      function
function @ 0x402970
  and:
    api: kernel32.TlsGetValue @ 0x4029A5

allocate RWX memory (2 matches)
namespace  host-interaction/process/inject
author     moritz.raabe@mandiant.com
scope      basic block
mbc        Memory::Allocate Memory [C0007]
basic block @ 0x401FCD in function 0x401EB0
  and:
    match: allocate memory @ 0x401FCD
      or:
        api: kernel32.VirtualProtect @ 0x401FF2
    number: 0x40 = PAGE_EXECUTE_READWRITE @ 0x401FDF, 0x40200F
basic block @ 0x40204A in function 0x401EB0
  and:
    match: allocate memory @ 0x40204A
      or:
        api: kernel32.VirtualProtect @ 0x40206B
    number: 0x40 = PAGE_EXECUTE_READWRITE @ 0x402054

terminate process
namespace  host-interaction/process/terminate
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com, anushka.virgaonkar@mandiant.com
scope      function
mbc        Process::Terminate Process [C0018]
function @ 0x4028E0
  or:
    and:
      or:
        api: kernel32.TerminateProcess @ 0x402959

create thread (2 matches)
namespace  host-interaction/thread/create
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com, joakim@intezer.com, anushka.virgaonkar@mandiant.com
scope      basic block
mbc        Process::Create Thread [C0038]
basic block @ 0x4015E2 in function 0x40158E
  or:
    and:
      os: windows
      or:
        api: kernel32.CreateThread @ 0x401634
basic block @ 0x401840 in function 0x401840
  or:
    and:
      os: windows
      or:
        api: kernel32.CreateThread @ 0x4018E4

link function at runtime on Windows (3 matches)
namespace  linking/runtime-linking
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com
scope      function
att&ck     Execution::Shared Modules [T1129]
function @ 0x4014B0
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x4012C2
    optional:
      characteristic: indirect call @ 0x40120F, 0x401293, 0x4012D6
function @ 0x4014F0
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x401523
    optional:
      characteristic: indirect call @ 0x401539
      api: kernel32.GetModuleHandle @ 0x401506
function @ 0x401950
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x4019CC, 0x4019E6
    optional:
      characteristic: indirect call @ 0x4019CC, 0x4019E6, 0x401A9A
      api: kernel32.LoadLibrary @ 0x4019A5

parse PE header
namespace  load-code/pe
author     moritz.raabe@mandiant.com
scope      function
att&ck     Execution::Shared Modules [T1129]
function @ 0x4023A0
  and:
    os: windows
    and:
      mnemonic: cmp @ 0x4023A6, 0x4023B3, 0x4023BD
      or:
        number: 0x4550 = IMAGE_NT_SIGNATURE (PE) @ 0x4023B3
      or:
        number: 0x5A4D = IMAGE_DOS_SIGNATURE (MZ) @ 0x4023A6

execute shellcode via indirect call
namespace  load-code/shellcode
author     ronnie.salomonsen@mandiant.com
scope      function
mbc        Memory::Allocate Memory [C0007]
function @ 0x401EB0
  and:
    match: allocate RWX memory @ 0x401FCD, 0x40204A
      and:
        match: allocate memory @ 0x40204A
          or:
            api: kernel32.VirtualProtect @ 0x40206B
        number: 0x40 = PAGE_EXECUTE_READWRITE @ 0x402054
      and:
        match: allocate memory @ 0x401FCD
          or:
            api: kernel32.VirtualProtect @ 0x401FF2
        number: 0x40 = PAGE_EXECUTE_READWRITE @ 0x401FDF, 0x40200F
    or:
      characteristic: indirect call @ 0x401F51, 0x401F89, 0x401FF2, 0x402034



